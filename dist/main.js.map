{"version":3,"sources":["../main.js"],"names":["board","Board","repl","ROUTINE_INTERVAL","monthCode","state","clearTypedCodeTimeOut","on","ledBouton","Led","trapOne","Pin","trapTwo","trapTop","LCD","controller","useChar","printMessage","message","console","log","numberOfScreen","Math","floor","length","duration","i","wait","firstLetter","clear","cursor","print","substr","setTimeout","off","emergencySwitch","Button","openTrapeTwo","redButton","now","format","doSunAction","shouldDiplayMessage","fadeOut","keyPad_A","keyPad_C","keyPad_G","keyPad_T","isTopOpen","closeTrapeTop","addTypedLetter","matrix","Matrix","addresses","dims","rotation","topServo","Servo","pin","startAt","letter","clearTimeout","typedCode","checkTypedCode","Number","openTrapeOne","giveCard","cardNumber","printCharOnMatrix","draw","openTrapeTop","char","timeout","CHARS","high","to","low","setInterval","isSame","messageTime","hours","minutes"],"mappings":"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","file":"main.js","sourcesContent":["\nimport five from 'johnny-five';\nimport moment from 'moment';\nimport {heart, initDayState, printSelectedMessage} from './utils';\n\nvar board = new five.Board({repl: false});\nvar ROUTINE_INTERVAL = 10000;\nvar monthCode = {\n    8: 'aaa',\n    9: 'atg',\n    10: 'tgg',\n    11: 'cat',\n    12: 'cta',\n    1: 'gta',\n};\n\nvar state = initDayState();\nvar clearTypedCodeTimeOut = null;\n\nboard.on('ready', function () {\n\n    /////////////// Init /////////////////\n\n//ledBouton\n    var ledBouton = new five.Led(3);\n\n//Traps\n    var trapOne = new five.Pin(2);\n    var trapTwo = new five.Pin(12);\n    var trapTop = new five.Pin(13);\n\n//LCD\n    var LCD = new five.LCD({\n        controller: 'PCF8574T',\n    });\n\n    LCD.useChar('heart');\n    LCD.useChar('pointerdown');\n    LCD.useChar('smile');\n    LCD.useChar('sdot');\n    LCD.useChar('note');\n\n//\n    LCD.printMessage = (message) => {\n        console.log('PRINTING : ' + message);\n        LCD.on();\n        let numberOfScreen = Math.floor(message.length / 32) + 1;\n        let duration = numberOfScreen * 3000;\n        for (let i = 0; i < numberOfScreen; i++) {\n            this.wait(3000 * i, function () {\n                let firstLetter = 32 * i;\n                LCD.clear();\n                LCD.cursor(0, 0);\n                LCD.print(message.substr(firstLetter, 16));\n                LCD.cursor(1, 0);\n                LCD.print(message.substr(firstLetter + 16, 16));\n            });\n        }\n        setTimeout(() => {\n            LCD.off();\n        }, duration);\n    };\n\n//EmergencySwitch\n    var emergencySwitch = new five.Button(6);\n\n    emergencySwitch.on('down', function () {\n        openTrapeTwo();\n    });\n\n//RedButton\n    var redButton = new five.Button(5);\n    redButton.on('press', function () {\n        console.log('mailPressed');\n        if (state.now.format('DD-MM-YYYY') === moment('10-11-2017', 'DD-MM-YYYY').format('DD-MM-YYYY')) {\n            doSunAction();\n        }\n        if (state.shouldDiplayMessage) {\n            printSelectedMessage(LCD.printMessage);\n            ledBouton.fadeOut(1000);\n        }\n    });\n\n//KeyPad\n    var keyPad_A = new five.Button(4);\n    var keyPad_C = new five.Button(9);\n    var keyPad_G = new five.Button(7);\n    var keyPad_T = new five.Button(8);\n//\n    keyPad_A.on('press', function () {\n        if (state.isTopOpen) {\n            closeTrapeTop();\n        } else {\n            addTypedLetter('a');\n        }\n    });\n    keyPad_C.on('press', function () {\n        addTypedLetter('c');\n    });\n    keyPad_G.on('press', function () {\n        addTypedLetter('g');\n    });\n    keyPad_T.on('press', function () {\n        addTypedLetter('t');\n    });\n\n//Matrix\n    var matrix = new five.Led.Matrix({\n        addresses: [0x70],\n        controller: 'HT16K33',\n        dims: '8x16',\n        rotation: 2,\n    });\n\n//Servo\n    var topServo = new five.Servo({\n        pin: 10,\n        startAt: 0,\n    });\n\n////////////////// Functions ////////////////\n\n    var addTypedLetter = (letter) => {\n        console.log('letter : ' + letter + ' pressed');\n        clearTimeout(clearTypedCodeTimeOut);\n        state.typedCode = state.typedCode + letter;\n        console.log('typed code : ' + state.typedCode);\n        clearTypedCodeTimeOut = setTimeout(() => state.typedCode = '', 3000);\n        checkTypedCode();\n    };\n\n    var checkTypedCode = () => {\n        if (monthCode[state.now.format('M')] === state.typedCode) {\n            console.log('Correct Code pour le mois de :');\n            switch (Number(state.now.format('M'))) {\n                case 9:\n                    console.log('septembre');\n                    openTrapeOne();\n                    break;\n                case 11:\n                    console.log('octobre');\n                    giveCard(1);\n                    break;\n                case 12:\n                    console.log('novembre');\n                    giveCard(2);\n                    break;\n                case 1:\n                    console.log('decembre');\n                    giveCard(3);\n                    break;\n                default:\n                    console.log('janvier');\n                    giveCard(4);\n                    break;\n            }\n        }\n    };\n\n    var giveCard = (cardNumber) => {\n        console.log('Giving Card... NÂ° ' + cardNumber);\n        LCD.on();\n        LCD.clear();\n        LCD.cursor(0, 0);\n        LCD.print('Prends une carte');\n        LCD.cursor(1, 0);\n        LCD.print(':smile::smile::pointerdown::pointerdown::pointerdown::pointerdown::pointerdown::pointerdown::pointerdown::pointerdown::pointerdown::pointerdown::pointerdown::pointerdown::smile::smile:');\n        setTimeout(() => {\n            LCD.off();\n        }, 10000);\n        printCharOnMatrix(cardNumber);\n    };\n\n    var doSunAction = () => {\n        console.log('Doing Sun Action...');\n        matrix.draw(heart);\n        setTimeout(() => matrix.clear(), 10000);\n        openTrapeTop();\n    };\n\n    var printCharOnMatrix = (char, timeout = 10000) => {\n        matrix.draw(five.Led.Matrix.CHARS[char]);\n        setTimeout(() => matrix.clear(), timeout);\n    };\n\n    var closeTrapeTop = () => {\n        console.log('closeTop');\n        trapTop.high();\n        topServo.to(10);\n        setTimeout(() => trapTop.low(), 1000);\n        state.isTopOpen = false;\n    };\n\n    var openTrapeTop = () => {\n        console.log('openTop');\n        trapTop.high();\n        setTimeout(() => trapTop.low(), 2000);\n        setTimeout(() => topServo.to(80), 1000);\n        state.isTopOpen = true;\n    };\n\n    var openTrapeOne = () => {\n        console.log('openOne');\n        printCharOnMatrix('arrownw');\n        trapOne.high();\n        setTimeout(() => trapOne.low(), 10000);\n        setTimeout(() => matrix.draw(heart), 10000);\n        setTimeout(() => matrix.clear(), 20000);\n    };\n\n    var openTrapeTwo = () => {\n        console.log('openTwo');\n        printCharOnMatrix('arrowne');\n        trapTwo.high();\n        setTimeout(() => trapTwo.low(), 10000);\n        setTimeout(() => matrix.draw(heart), 10000);\n        setTimeout(() => matrix.clear(), 20000);\n    };\n\n////////////////// Routine ////////////////\n\n    setInterval(\n        function () {\n            let now = moment();\n            if (!now.isSame(state.messageTime, 'day')) {\n                state = initDayState();\n            }\n            if (state.messageTime.hours() === now.hours() && state.messageTime.minutes() === now.minutes()) {\n                state.shouldDiplayMessage = true;\n                ledBouton.on();\n            }\n        }, ROUTINE_INTERVAL);\n\n    LCD.printMessage('Hey jolie jeune fille !');\n});"]}